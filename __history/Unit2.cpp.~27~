//---------------------------------------------------------------------------

#include <vcl.h>
#include <string>
#pragma hdrstop

#include "Unit2.h"
#include "Unit9.h"
#include "Unit1.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm2 *Form2;
//---------------------------------------------------------------------------
__fastcall TForm2::TForm2(TComponent* Owner)
	: TForm(Owner)
{
}
//----------Глобальные объекты-----------------------------------------------
float data[3];
string GroupName = Form1->StringGrid1->Cells[3][0];
AnsiString Title = "График среднего балла группы"; + GroupName;
//---------------------------------------------------------------------------
void __fastcall TForm2::FormResize(TObject *Sender)
{
	Form2->Refresh(); // обновить содержимое окна
}
//---------------------------------------------------------------------------
void __fastcall TForm2::FormPaint(TObject *Sender)
{
	data[0] = StrToFloat(Form9->Label2->Caption);
	data[1] = StrToFloat(Form9->Label3->Caption);
	data[2] = StrToFloat(Form9->Label4->Caption);

	int x, y;
	// заголовок
	Canvas->Font->Name = "Tahoma";
	Canvas->Font->Size =12;

	x = (ClientWidth - Canvas->TextWidth(Title)) /2;

	Canvas->Brush->Style = bsClear;
	Canvas->TextOut(x,10,Title);

	// гистограмма
	int n; // количество столбцов
	int wCol; // ширина столбца

	#define MC 5 // расстояние между столбиками по горизонтали
	n = sizeof(data) / sizeof(float);
	wCol = (ClientWidth - (n - 1)*MC - 20) / n;
	x = 10;
	y = ClientHeight - 20;

	// найти минимальное и максимальное значение данных
	int min,max; // индекс миним, и максим, элемент

	min = 0 ; // пусть первый элемент минимальный
	max = 0 ; // пусть первый элемент максимальный

	for (int i = 1; i < n; i++)
	{
		if (data[i] < data[min]) min = i;
		if (data[i] > data[max]) max = i;
	}

	/* Если отклонение значений ряда от среднего значения
	незначительное, то диаграмма получается ненаглядной.
	В этом случае можно построить не абсолютные значения,
	а отклонения от минимального значения ряда. */

	bool frmin = true; // true - отсчитывать от минимального
	int h; // высота столбика
	// максимальному значению соответствует
	// столбик высотой ClientHeight - 90

	Canvas->Font->Size -= 2;

	for ( int i = 0; i < n; i++)
	{
		if (!frmin)
			h = (ClientHeight - 90) * data[i]/data[max];
		else
			/* Отсчитывать от минимального значения.
			Минимальное значение отобразим столбиком
			высотой 10 пикселов */
			h = (ClientHeight - 90) * (data[i] - data[min])/(data[max] - data[min]) + 10;

		Canvas->Brush->Style = bsSolid;
		Canvas->Brush->Color = clBlue;
		Canvas->Rectangle(x,y,x+wCol,y-h); // столбик

		// подпись данных
		AnsiString st;
		st = FloatToStrF(data[i],ffGeneral,5,2);
		Canvas->Brush->Style = bsClear; // область вывода
		// текста - прозрачная

		Canvas->TextOut(x,y-h-20,st);
		x = x + wCol + MC;
	}
}
//---------------------------------------------------------------------------
