//---------------------------------------------------------------------------
#include <vcl.h>
#include <stdio.h>
#include <vector>
#pragma hdrstop

#include "Unit1.h"
#include "Unit3.h"
#include "Unit5.h"
#include "Unit6.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
//---------------------------------------------------------------------------
using namespace std;
//---------------------------------------------------------------------------
TForm1 *Form1;
//---------------------------------------------------------------------------
struct TStudent
{
   UnicodeString surname;
   UnicodeString name;
   UnicodeString otchestvo;
   UnicodeString groupNumber;
   UnicodeString offset[5];
   int exam[3];
   UnicodeString defrayal;
};
//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
vector <TStudent> student;
TStudent studStruct;
int iterCounter = 0;
//---------------------------------------------------------------------------
void __fastcall TForm1::FormCreate(TObject *Sender)
{
	StringGrid1->Cells[0][0] = "Фамилия"; StringGrid1->Cells[1][0] = "Имя";
	StringGrid1->Cells[2][0] = "Отчество"; StringGrid1->Cells[3][0] = "№ группы";
	StringGrid1->Cells[4][0] = "Зачет 1"; StringGrid1->Cells[5][0] = "Зачет 2";
	StringGrid1->Cells[6][0] = "Зачет 3"; StringGrid1->Cells[7][0] = "Зачет 4";
	StringGrid1->Cells[8][0] = "Зачет 5"; StringGrid1->Cells[9][0] = "Экзамен 1";
	StringGrid1->Cells[10][0] = "Экзамен 2"; StringGrid1->Cells[11][0] = "Экзамен 3";
	StringGrid1->Cells[12][0] = "Вид оплаты";
}
//---------------------------------------------------------------------------
void __fastcall TForm1::N5Click(TObject *Sender)
{
	StringGrid1->Options = StringGrid1->Options << goEditing;
	ShowMessage("Корректирование таблицы разрешено!");
}
//---------------------------------------------------------------------------
void __fastcall TForm1::N11Click(TObject *Sender)
{
	MessageDlg("Автор приложения студент группы ИСТ-11 Сорочук Евгений, БарГу", mtInformation, TMsgDlgButtons() << mbCancel  ,0);
}
//---------------------------------------------------------------------------
void __fastcall TForm1::N1Click(TObject *Sender)
{
	if (MessageDlg("Вы уверены?Данные будут потеряны!\nДля сохранения данных таблицы воспользуйтесь вкладкой 'Сохранить'", mtConfirmation, TMsgDlgButtons() << mbYes << mbNo,0) == mrYes)
	{
		StringGrid1->ColCount = 13; StringGrid1->RowCount = 1;

		/*----Очистка вектора----*/
		if (student.size() != 0)
			for (int j = student.size(); j >= 0; j--)
				student.pop_back();
	}
}
//---------------------------------------------------------------------------
void __fastcall TForm1::N7Click(TObject *Sender)
{
	Form5->ShowModal();
}
//---------------------------------------------------------------------------
void __fastcall TForm1::N8Click(TObject *Sender)
{
	Form6->Memo1->Clear();

	int form1RowsCounter, sortRowsCounter = 0;                      // sortRowsCounter запоминает кол-во
	float averageMarkExam1 = 0,  // Средний балл за экзамен1       // считаных конструкцией if строк
		  averageMarkExam2 = 0,  // Средний балл за экзамен2
		  averageMarkExam3 = 0;  // Средний балл за экзамен3

	form1RowsCounter = StrToInt(StringGrid1->RowCount);

	for (int i = 1; i < form1RowsCounter; i++)
		if(StringGrid1->Cells[12][i] == "Госбюджет")
		{
			averageMarkExam1 += StrToFloat(StringGrid1->Cells[9][i]);
			sortRowsCounter++;
		}
	averageMarkExam1 /= sortRowsCounter;
	sortRowsCounter = 0;

	for (int i = 1; i < form1RowsCounter; i++)
		if(StringGrid1->Cells[12][i] == "Госбюджет")
		{
			averageMarkExam2 += StrToFloat(StringGrid1->Cells[10][i]);
			sortRowsCounter++;
		}
	averageMarkExam2 /= sortRowsCounter;
	sortRowsCounter = 0;

	for (int i = 1; i < form1RowsCounter; i++)
		if(StringGrid1->Cells[12][i] == "Госбюджет")
		{
			averageMarkExam3 += StrToFloat(StringGrid1->Cells[11][i]);
			sortRowsCounter++;
		}
	averageMarkExam3 /= sortRowsCounter;
	sortRowsCounter = 0;

	Form6->Memo1->Lines->Add("Средний балл за экзамен1: " + FloatToStrF(averageMarkExam1,ffFixed,3,2));
	Form6->Memo1->Lines->Add("Средний балл за экзамен2: " + FloatToStrF(averageMarkExam2,ffFixed,3,2));
	Form6->Memo1->Lines->Add("Средний балл за экзамен3: " + FloatToStrF(averageMarkExam3,ffFixed,3,2));

	Form6->Show();
}
//---------------------------------------------------------------------------
void __fastcall TForm1::N9Click(TObject *Sender)
{
	Form6->Memo1->Clear();

	int form1RowsCounter, sortRowsCounter = 0;                  // sortRowsCounter запоминает кол-во
	float averageMarkExam1 = 0,  // Средний балл за экзамен1   // считаных конструкцией if строк
		  averageMarkExam2 = 0,  // Средний балл за экзамен2
		  averageMarkExam3 = 0;  // Средний балл за экзамен3

	form1RowsCounter = StrToInt(Form1->StringGrid1->RowCount);

	for (int i = 1; i < form1RowsCounter; i++)
		if(Form1->StringGrid1->Cells[12][i] == "Коммерческая")
		{
			averageMarkExam1 += StrToFloat(Form1->StringGrid1->Cells[9][i]);
			sortRowsCounter++;
		}
	averageMarkExam1 /= sortRowsCounter;
	sortRowsCounter = 0;

	for (int i = 1; i < form1RowsCounter; i++)
		if(Form1->StringGrid1->Cells[12][i] == "Коммерческая")
		{
			averageMarkExam2 += StrToFloat(Form1->StringGrid1->Cells[10][i]);
			sortRowsCounter++;
		}
	averageMarkExam2 /= sortRowsCounter;
	sortRowsCounter = 0;

	for (int i = 1; i < form1RowsCounter; i++)
		if(Form1->StringGrid1->Cells[12][i] == "Коммерческая")
		{
			averageMarkExam3 += StrToFloat(Form1->StringGrid1->Cells[11][i]);
			sortRowsCounter++;
		}
	averageMarkExam3 /= sortRowsCounter;
	sortRowsCounter = 0;

	Form6->Memo1->Lines->Add("Средний балл за экзамен1: " + FloatToStrF(averageMarkExam1,ffFixed,3,2));
	Form6->Memo1->Lines->Add("Средний балл за экзамен2: " + FloatToStrF(averageMarkExam2,ffFixed,3,2));
	Form6->Memo1->Lines->Add("Средний балл за экзамен3: " + FloatToStrF(averageMarkExam3,ffFixed,3,2));

	Form6->Show();
}
//---------------------------------------------------------------------------
void __fastcall TForm1::N3Click(TObject *Sender)
{
	TStringList *Table1 = new TStringList;

	if (SaveDialog1->Execute())
		for(int i = 0; i < StringGrid1->RowCount; i++)
			Table1->Add(StringGrid1->Rows[i]->DelimitedText);

	Table1->SaveToFile(SaveDialog1->FileName);

	delete Table1;
}
//---------------------------------------------------------------------------
void __fastcall TForm1::N2Click(TObject *Sender)
{
	/*----Очистка вектора----*/
	if (student.size() != 0)
		for (int j = student.size(); j >= 0; j--)
			student.pop_back();

	TStringList *Table1 = new TStringList;

	if (OpenDialog1->Execute())
	{
		Table1->LoadFromFile(OpenDialog1->FileName);
		StringGrid1->RowCount = Table1->Count;

		for(int i = 0; i < StringGrid1->RowCount; i++)
			StringGrid1->Rows[i]->DelimitedText = Table1->Strings[i];

	delete Table1;

		for (int i = 1; i < StringGrid1->RowCount; i++)
		{
			studStruct.surname = StringGrid1->Cells[0][i];
			studStruct.name = StringGrid1->Cells[1][i];
			studStruct.otchestvo = StringGrid1->Cells[2][i];
			studStruct.groupNumber = StringGrid1->Cells[3][i];
			studStruct.offset[0] = StringGrid1->Cells[4][i];
			studStruct.offset[1] = StringGrid1->Cells[5][i];
			studStruct.offset[2] = StringGrid1->Cells[6][i];
			studStruct.offset[3] = StringGrid1->Cells[7][i];
			studStruct.offset[4] = StringGrid1->Cells[8][i];
			studStruct.exam[0] = StrToInt(StringGrid1->Cells[9][i]);
			studStruct.exam[1] = StrToInt(StringGrid1->Cells[10][i]);
			studStruct.exam[2] = StrToInt(StringGrid1->Cells[11][i]);
			studStruct.defrayal = StringGrid1->Cells[12][i];
			student.push_back(studStruct);
		}

		/*----очистка StringGrid----*/
		for (int i = 1; i < StringGrid1->RowCount; i++)
			for (int j = 0; j < StringGrid1->ColCount; j++)
				StringGrid1->Cells[j][i] = "";

		/*----Сортировка вектора----*/
		for (unsigned i = 0; i < student.size() - 1; i++)
		{
			int imin = i;
			for (unsigned j = i + 1; j < student.size(); j++ )
				if ( student[j].surname < student[imin].surname ) imin = j;
			TStudent a = student[i]; // обмен двух элементов массива структур
			student[i] = student[imin];
			student[imin] = a;
		}

		/*----Запись вектора структур в StringGrid----*/
		for (int j = 1; j < StringGrid1->RowCount + 1; j++)
		{
			StringGrid1->Cells[0][j] = student[j - 1].surname;
			StringGrid1->Cells[1][j] = student[j - 1].name;
			StringGrid1->Cells[2][j] = student[j - 1].otchestvo;
			StringGrid1->Cells[3][j] = student[j - 1].groupNumber;
			StringGrid1->Cells[4][j] = student[j - 1].offset[0];
			StringGrid1->Cells[5][j] = student[j - 1].offset[1];
			StringGrid1->Cells[6][j] = student[j - 1].offset[2];
			StringGrid1->Cells[7][j] = student[j - 1].offset[3];
			StringGrid1->Cells[8][j] = student[j - 1].offset[4];
			StringGrid1->Cells[9][j] = IntToStr(student[j - 1].exam[0]);
			StringGrid1->Cells[10][j] = IntToStr(student[j - 1].exam[1]);
			StringGrid1->Cells[11][j] = IntToStr(student[j - 1].exam[2]);
			StringGrid1->Cells[12][j] = student[j - 1].defrayal;
		}
	}
}
//---------------------------------------------------------------------------
void __fastcall TForm1::Button1Click(TObject *Sender)
{
	studStruct.surname = Edit1->Text; studStruct.name = Edit2->Text;
	studStruct.otchestvo = Edit3->Text; studStruct.groupNumber = Edit4->Text;
	studStruct.offset[0] = ComboBox2->Text; studStruct.offset[1] = ComboBox3->Text;
	studStruct.offset[2] = ComboBox4->Text; studStruct.offset[3] = ComboBox5->Text;
	studStruct.offset[4] = ComboBox6->Text; studStruct.exam[0] = StrToInt(ComboBox7->Text);
	studStruct.exam[1] = StrToInt(ComboBox8->Text); studStruct.exam[2] = StrToInt(ComboBox9->Text);
	studStruct.defrayal = ComboBox1->Text;

	student.push_back(studStruct);

	/*----очистка StringGrid----*/
	for (int i = 1; i < StringGrid1->RowCount; i++)
		for (int j = 0; j < StringGrid1->ColCount; j++)
			StringGrid1->Cells[j][i] = "";

	if (student.size() < 2) {
		StringGrid1->Cells[0][StringGrid1->RowCount] = student[0].surname;
		StringGrid1->Cells[1][StringGrid1->RowCount] = student[0].name;
		StringGrid1->Cells[2][StringGrid1->RowCount] = student[0].otchestvo;
		StringGrid1->Cells[3][StringGrid1->RowCount] = student[0].groupNumber;
		StringGrid1->Cells[4][StringGrid1->RowCount] = student[0].offset[0];
		StringGrid1->Cells[5][StringGrid1->RowCount] = student[0].offset[1];
		StringGrid1->Cells[6][StringGrid1->RowCount] = student[0].offset[2];
		StringGrid1->Cells[7][StringGrid1->RowCount] = student[0].offset[3];
		StringGrid1->Cells[8][StringGrid1->RowCount] = student[0].offset[4];
		StringGrid1->Cells[9][StringGrid1->RowCount] = IntToStr(student[0].exam[0]);
		StringGrid1->Cells[10][StringGrid1->RowCount] = IntToStr(student[0].exam[1]);
		StringGrid1->Cells[11][StringGrid1->RowCount] = IntToStr(student[0].exam[2]);
		StringGrid1->Cells[12][StringGrid1->RowCount] = student[0].defrayal;
	} else
	{
		/*----Сортировка вектора----*/
		for (unsigned i = 0; i < student.size() - 1; i++)
		{
			int imin = i;
			for (unsigned j = i + 1; j < student.size(); j++ )
				if ( student[j].surname < student[imin].surname ) imin = j;
			TStudent a = student[i]; // обмен двух элементов массива структур
			student[i] = student[imin];
			student[imin] = a;
		}

		/*----Запись вектора структур в StringGrid----*/
		for (int j = 1; j < StringGrid1->RowCount + 1; j++)
		{
			StringGrid1->Cells[0][j] = student[j - 1].surname;
			StringGrid1->Cells[1][j] = student[j - 1].name;
			StringGrid1->Cells[2][j] = student[j - 1].otchestvo;
			StringGrid1->Cells[3][j] = student[j - 1].groupNumber;
			StringGrid1->Cells[4][j] = student[j - 1].offset[0];
			StringGrid1->Cells[5][j] = student[j - 1].offset[1];
			StringGrid1->Cells[6][j] = student[j - 1].offset[2];
			StringGrid1->Cells[7][j] = student[j - 1].offset[3];
			StringGrid1->Cells[8][j] = student[j - 1].offset[4];
			StringGrid1->Cells[9][j] = IntToStr(student[j - 1].exam[0]);
			StringGrid1->Cells[10][j] = IntToStr(student[j - 1].exam[1]);
			StringGrid1->Cells[11][j] = IntToStr(student[j - 1].exam[2]);
			StringGrid1->Cells[12][j] = student[j - 1].defrayal;
		}
	}
	StringGrid1->RowCount++;
	Edit1->Text = ""; Edit2->Text = ""; Edit3->Text = ""; Edit4->Text = "";
	ComboBox1->Text = "Вид оплаты";  ComboBox2->Text = "Зачет 1";  ComboBox3->Text = "Зачет 2";
	ComboBox4->Text = "Зачет 3"; ComboBox5->Text = "Зачет 4";; ComboBox6->Text = "Зачет 5";;
	ComboBox7->Text = "Экзамен 1"; ComboBox8->Text = "Экзамен 2"; ComboBox9->Text = "Экзамен 3";

	ShowMessage(student.size());
}
//---------------------------------------------------------------------------

